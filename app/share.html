<!DOCTYPE html>
<html>
<head>
	<title> Share </title>

	<!-- <script type="text/javascript" src="libs/jquery-3.5.1.js"></script> -->
	<!-- <script type="text/javascript" src="libs/webtorrent.min.js"></script> -->
	
	<script src="https://cdn.jsdelivr.net/npm/jquery@3.5.0/dist/jquery.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/webtorrent@0.108.6/webtorrent.min.js"></script>

	<script type="text/javascript">
		$(function(){
			console.log('ready');
			
			const onFileChange = function(event){
				console.log('onFileChange')
				var fileList = event.target.files
				console.log(fileList[0])

				const client = new WebTorrent()
				client.seed(fileList, function(torrent){
					console.log('Seeding',torrent.magnetURI)
					$('#divInfo').html( torrent.magnetURI )
				})
			}
			/*
			const onFileURLChange = function(event){
				const fileUrl = event.target.value
				console.log(event.target.value)
				return false
			}
			*/
			const onGet = function(){
				const client = new WebTorrent()
				var torrentId = $('#outputFile').val()
				
				client.add(torrentId, function (torrent) {
				  var file = torrent.files.find(function (file) {
				    return file.name.endsWith('.jpg')
				  })
				  //file.appendTo('body')
				  file.appendTo('#divDownloaded')
				})
			}

			//
			//$('#outputFile').on('change', onFileURLChange)
			$('#inputFile').on('change', onFileChange)
			$('#btnGet').on('click',onGet);
		})
	</script>
</head>
<body>
	<h3>Share</h3>

	<div style="margin:1em;">
		<input id="inputFile" type="file" name="fileupload" value="fileupload" />
		<br>
		<div id="divInfo" />
	</div>
	<br>
	<div style="margin:1em;">
		<input id="outputFile" type="test" name="fileurl">
		<button id="btnGet"> Get </button>
	</div>
	down
	<div id="divDownloaded" />
	<br/>
	loaded
</body>
</html>