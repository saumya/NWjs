<!DOCTYPE html>
<html>
<head>
	<title> Share </title>

	<!-- <script type="text/javascript" src="libs/jquery-3.5.1.js"></script> -->
	<!-- <script type="text/javascript" src="libs/webtorrent.min.js"></script> -->

	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.0/css/bulma.min.css">
	
	<script src="https://cdn.jsdelivr.net/npm/jquery@3.5.0/dist/jquery.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/webtorrent@0.108.6/webtorrent.min.js"></script>

	
</head>
<body>

	<section class="section">
		<h3 class="title"> Share </h3>
		<h4 class="subtitle"> The world is free </h4>	

		<p>
			For the time being, it only supports <strong>.jpg</strong> images.
		</p>
		<input class="input" id="inputFile" type="file" name="fileupload" value="fileupload" />
		<textarea class="textarea is-danger" id="divInfo" placeholder="Please wait for it." style="width:36em; height:14em; overflow: scroll;"></textarea>
	</section>
	
	<section class="section">
		<div class="field has-addons">
		  <div class="control is-expanded">
		    <input id="outputFile" class="input is-success" type="text" placeholder="File Url">
		  </div>
		  <div class="control">
		    <button id="btnGet" class="button is-success"> Get it </button>
		  </div>
		</div>
	</section>
	
	<section id="divDownloaded" class="section"></section> 
	


	<script type="text/javascript">
		$(function(){
			console.log('ready');
			
			const onFileChange = function(event){
				console.log('onFileChange')
				var fileList = event.target.files
				console.log(fileList[0])

				const client = new WebTorrent()
				client.seed(fileList, function(torrent){
					console.log('Seeding',torrent.magnetURI)
					$('#divInfo').html( torrent.magnetURI )
					// Copying to Clipboard
					navigator.clipboard.writeText( torrent.magnetURI )
				})
			}
			/*
			const onFileURLChange = function(event){
				const fileUrl = event.target.value
				console.log(event.target.value)
				return false
			}
			*/
			const onGet = function(){
				const client = new WebTorrent()
				var torrentId = $('#outputFile').val()
				
				client.add(torrentId, function (torrent) {
				  var file = torrent.files.find(function (file) {
				    return file.name.endsWith('.jpg')
				  })
				  //file.appendTo('body')
				  file.appendTo('#divDownloaded')
				})
			}

			//
			//$('#outputFile').on('change', onFileURLChange)
			$('#inputFile').on('change', onFileChange)
			$('#btnGet').on('click',onGet);
		})
	</script>

</body>
</html>